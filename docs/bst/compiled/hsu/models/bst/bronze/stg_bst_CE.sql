

WITH juntar_companyies AS (
    SELECT 
        TIPO_DOCUMENTACION AS TIPO_DOCUMENTACION, 
        DOCUMENTACION AS DOCUMENTACION, 
        NOMBRE AS NOMBRE,
        NULL AS NOMBRE_Y_APELLIDOS,
        APELLIDO1 AS APELLIDO1,
        APELLIDO2 AS APELLIDO2,
        NULL AS APELLIDOS,
        MAIL AS MAIL,
        NULL AS MAIL_1,
        NULL AS MAIL_2,
        TELEFONO AS TELEFONO,
        NULL AS TELEFONO_1,
        NULL AS TELEFONO_2,
        NULL AS TELEFONO_3,
        CONSIDERACION AS CONSIDERACION,
        DIRECCION AS DIRECCION,
        NULL AS TIPO_VIA,
        NULL AS NOMBRE_VIA,
        NULL AS NUMERO,
        NULL AS BLOQUE,
        NULL AS PORTAL,
        NULL AS ESCALERA,
        NULL AS PISO,
        NULL AS PUERTA,
        '07' AS PROVINCIA,
        MUNICIPIO AS MUNICIPIO,
        CODIGO_POSTAL AS CODIGO_POSTAL,
        CUENTA_BANCARIA AS CUENTA_BANCARIA,
        'ENDESA' AS COMERCIALIZADORA,
        ANIO AS ANIO,
        FECHA_INSERCION AS FECHA_INSERCION 
    FROM HSU.RAW_BST_CE_ENDESA

    UNION ALL

    SELECT 
        NULL AS TIPO_DOCUMENTACION,
        IDENTIFICACION AS DOCUMENTACION, 
        NOMBRE AS NOMBRE,
        NULL AS NOMBRE_Y_APELLIDOS,
        APELLIDO1 AS APELLIDO1,
        APELLIDO2 AS APELLIDO2,
        NULL AS APELLIDOS,
        NULL AS MAIL,
        NULL AS MAIL_1,
        NULL AS MAIL_2,
        TELEFONO_1 AS TELEFONO,
        NULL AS TELEFONO_1,
        TELEFONO_2 AS TELEFONO_2,
        TELEFONO_3 AS TELEFONO_3,
        CONSIDERACION AS CONSIDERACION,
        DIRECCION AS DIRECCION,
        TIPO_VIA AS TIPO_VIA,
        NOMBRE_VIA AS NOMBRE_VIA,
        NUMERO AS NUMERO,
        BLOQUE AS BLOQUE,
        PORTAL AS PORTAL,
        ESCALERA AS ESCALERA,
        PLANTA AS PISO,
        PUERTA AS PUERTA,
        '07' AS PROVINCIA,
        MUNICIPIO AS MUNICIPIO,
        CODIGO_POSTAL AS CODIGO_POSTAL,
        CUENTA_BANCARIA AS CUENTA_BANCARIA,
        'NATURGY' AS COMERCIALIZADORA,
        ANIO AS ANIO,
        FECHA_INSERCION AS FECHA_INSERCION 
    FROM HSU.RAW_BST_CE_NATURGY

    UNION ALL

    SELECT 
        NULL AS TIPO_DOCUMENTACION,
        DNI AS DOCUMENTACION, 
        NOMBRE AS NOMBRE,
        NULL AS NOMBRE_Y_APELLIDOS,
        APELLIDO1 AS APELLIDO1,
        APELLIDO2 AS APELLIDO2,
        APELLIDOS AS APELLIDOS,
        EMAIL AS MAIL,
        NULL AS MAIL_1,
        NULL AS MAIL_2,
        TELEFONO AS TELEFONO,
        NULL AS TELEFONO_1,
        NULL AS TELEFONO_2,
        NULL AS TELEFONO_3,
        CONSIDERACION AS CONSIDERACION,
        DIRECCION AS DIRECCION,
        NULL AS TIPO_VIA,
        NULL AS NOMBRE_VIA,
        NULL AS NUMERO,
        NULL AS BLOQUE,
        NULL AS PORTAL,
        NULL AS ESCALERA,
        NULL AS PISO,
        NULL AS PUERTA,
        '07' AS PROVINCIA,
        MUNICIPIO AS MUNICIPIO,
        CP AS CODIGO_POSTAL,
        IBAN AS CUENTA_BANCARIA,
        'BASER' AS COMERCIALIZADORA,
        ANIO AS ANIO,
        FECHA_INSERCION AS FECHA_INSERCION 
    FROM HSU.RAW_BST_CE_BASER

    UNION ALL

    SELECT 
        NULL AS TIPO_DOCUMENTACION,
        NIF_NIE AS DOCUMENTACION, 
        NOMBRE AS NOMBRE,
        NULL AS NOMBRE_Y_APELLIDOS,
        APELLIDO1 AS APELLIDO1,
        APELLIDO2 AS APELLIDO2,
        NULL AS APELLIDOS,
        EMAIL AS MAIL,
        NULL AS MAIL_1,
        NULL AS MAIL_2,
        TELEFONO AS TELEFONO,
        NULL AS TELEFONO_1,
        NULL AS TELEFONO_2,
        NULL AS TELEFONO_3,
        CONDICION_VULNERABLE AS CONSIDERACION,
        DIRECCION AS DIRECCION,
        NULL AS TIPO_VIA,
        NULL AS NOMBRE_VIA,
        NULL AS NUMERO,
        NULL AS BLOQUE,
        NULL AS PORTAL,
        NULL AS ESCALERA,
        NULL AS PISO,
        NULL AS PUERTA,
        '07' AS PROVINCIA,
        MUNICIPIO AS MUNICIPIO,
        COD_POSTAL AS CODIGO_POSTAL,
        CUENTA_BANCARIA AS CUENTA_BANCARIA,
        'CURENERGIA' AS COMERCIALIZADORA,
        ANIO AS ANIO,
        FECHA_INSERCION AS FECHA_INSERCION 
    FROM HSU.RAW_BST_CE_CURENERGIA

    UNION ALL

    SELECT 
        NULL AS TIPO_DOCUMENTACION,
        DNI AS DOCUMENTACION, 
        NOMBRE AS NOMBRE,
        NOMBRE_Y_APELLIDOS AS NOMBRE_Y_APELLIDOS,
        NULL AS APELLIDO1,
        NULL AS APELLIDO2,
        APELLIDOS AS APELLIDOS,
        CORREO_ELECTRONICO AS MAIL,
        MAIL_1 AS MAIL_1,
        MAIL_2 AS MAIL_2,
        N_DE_TELEFONO AS TELEFONO,
        TELEFONO_1 AS TELEFONO_1,
        TELEFONO_2 AS TELEFONO_2,
        NULL AS TELEFONO_3,
        CONSIDERACION AS CONSIDERACION,
        DIRECCION AS DIRECCION,
        TIPO_VIA AS TIPO_VIA,
        CALLE AS NOMBRE_VIA,
        NUMERO AS NUMERO,
        PISO AS PISO,
        PUERTA AS PUERTA,
        NULL AS BLOQUE,
        NULL AS PORTAL,
        NULL AS ESCALERA,
        '07' AS PROVINCIA,
        MUNICIPIO AS MUNICIPIO,
        CODIGO_POSTAL AS CODIGO_POSTAL,
        CUENTA_BANCARIA AS CUENTA_BANCARIA,
        'REGSITI' AS COMERCIALIZADORA,
        ANIO AS ANIO,
        FECHA_INSERCION AS FECHA_INSERCION 
    FROM HSU.RAW_BST_CE_REGSITI

    UNION ALL

    SELECT 
        NULL AS TIPO_DOCUMENTACION,
        DNI AS DOCUMENTACION, 
        NOMBRE AS NOMBRE,
        NULL AS NOMBRE_Y_APELLIDOS,
        APELLIDO1 AS APELLIDO1,
        APELLIDO2 AS APELLIDO2,
        NULL AS APELLIDOS,
        CORREO_ELECTRONICO AS MAIL,
        NULL AS MAIL_1,
        NULL AS MAIL_2,
        TELEFONO AS TELEFONO,
        NULL AS TELEFONO_1,
        NULL AS TELEFONO_2,
        NULL AS TELEFONO_3,
        GRADO_DE_VULNERABILIDAD AS CONSIDERACION,
        NULL AS DIRECCION,
        TIPO_VIA AS TIPO_VIA,
        NOMBRE_VIA AS NOMBRE_VIA,
        NUMERO AS NUMERO,
        NULL AS PISO,
        NULL AS PUERTA,
        NULL AS BLOQUE,
        NULL AS PORTAL,
        NULL AS ESCALERA,
        '07' AS PROVINCIA,
        COD_MUNICIPIO AS MUNICIPIO,
        CP AS CODIGO_POSTAL,
        IBAN AS CUENTA_BANCARIA,
        'COR' AS COMERCIALIZADORA,
        ANIO AS ANIO,
        FECHA_INSERCION AS FECHA_INSERCION 
    FROM HSU.RAW_BST_CE_COR
)

SELECT * FROM juntar_companyies jc
WHERE (jc.DOCUMENTACION IS NOT NULL
OR jc.CONSIDERACION IS NOT NULL
OR jc.CODIGO_POSTAL IS NOT NULL)
AND REGEXP_LIKE(jc.CODIGO_POSTAL, '^[0-9]{1,5}$')